/**
// @name        CanvasLMS - Global Custom Navigation
// @namespace   https://github.com/robert-carroll/canvaslms-global-custom-navigation
// @description items only
//
**/

// handle css in this js file, or you can remove it if...
// you include the contents of /css/global-custom-nav-items.css in your Canvas Themes css file
!function(){if(0==document.querySelectorAll('[data-global-custom-nav-css="set"]').length){let e={"i.gcn_inst_menu_icon:before":"font-size: 1.625rem;","i.gcn_inst_rspv_icon":"color: var(--ic-brand-primary);"};if(void 0!==e&&Object.keys(e).length>0){let t=document.createElement("style");t.setAttribute("data-global-custom-nav-css","set"),document.head.appendChild(t);let n=t.sheet;Object.keys(e).forEach((function(t){n.insertRule(`${t} { ${e[t]} }`,n.cssRules.length)}))}}}();

(function () {
  'use strict';

  // minified line for global custom nav [items only]
  const globalCustomNav={cfg:{glbl:{nav_selector:"#menu",trayActiveClass:"ic-app-header__menu-list-item--active"},rspv:{tray_portal:`span[dir="${document.querySelector("html").getAttribute("dir")??"ltr"}"] div[role="dialog"] ul`,tray_container:'div[class$="-tray__content"]'},targets:["_self","_blank","_parent","_top"]},load:e=>{(document.querySelector(globalCustomNav.cfg.glbl.nav_selector)||document.querySelector(globalCustomNav.cfg.rspv.tray_portal))&&("undefined"!==document.querySelector(globalCustomNav.cfg.glbl.nav_selector)&&(globalCustomNav.dir=document.querySelector("html").getAttribute("dir")??"ltr",globalCustomNav.opts=[],globalCustomNav.nav_items=Array.isArray(e.nav_items)?e.nav_items:e,globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!1)),globalCustomNav.watch_burger_tray())},watch_burger_tray:(e,t)=>{const o=document.querySelector(globalCustomNav.cfg.rspv.tray_portal),r=document.querySelector("div.rspv-global-custom-nav");if(o)null==o||null==document.querySelector(".mobile-header-hamburger").offsetParent||r||(t.disconnect(),globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!0),document.querySelector(globalCustomNav.cfg.rspv.tray_container).classList.add("rspv-global-custom-nav"),globalCustomNav.exit_burger_tray());else if(void 0===t){new MutationObserver(globalCustomNav.watch_burger_tray).observe(document.body,{childList:!0,subtree:!0})}},exit_burger_tray:(e,t)=>{const o=document.querySelector(globalCustomNav.cfg.rspv.tray_portal);if(o){if(void 0===t){new MutationObserver(globalCustomNav.exit_burger_tray).observe(document.body,{childList:!0,subtree:!0})}}else o||(t.disconnect(),globalCustomNav.watch_burger_tray())},prepare_nav_items:(e,t=!0)=>{e.forEach((e=>{(void 0===e.roles||e.roles())&&(globalCustomNav.create_nav_icon(e,t),globalCustomNav.append_item(e,t),e.tray&&globalCustomNav.tray(e,t))}))},create_nav_icon:(e,t=!0)=>{e.tidle=e.title.replace(/\s+/g,""),e.slug=`global_nav_${e.tidle}_link`;const o=1==ENV.K5_USER&&1==t?"Home":"Dashboard",r=t?`${globalCustomNav.cfg.rspv.tray_portal} svg[name="Icon${o}"]`:`#global_nav_${o.toLowerCase()}_link`,a=document.querySelector(r).closest("li").cloneNode(!0);a.setAttribute("id",(t?"rspv-":"")+`${e.slug}-item`),a.querySelector("svg").parentElement.classList.add((t?"rspv-":"")+`svg-${e.tidle}-holder`);const l=(t?"rspv-":"")+e.slug;a.querySelector("a").setAttribute("id",l),a.querySelector("a").href=e.href,void 0!==e.target&&globalCustomNav.cfg.targets.includes(e.target)&&a.querySelector("a").setAttribute("target",e.target);try{(a.querySelector(".menu-item__text")||a.querySelector('span[letter-spacing="normal"]')).textContent=e.title}catch(e){console.log(e)}const s=a.querySelector((t?".rspv-svg":".svg")+`-${e.tidle}-holder`);a.querySelector("svg").classList.remove("ic-icon-svg--dashboard","svg-icon-home");let c=[...a.querySelector("svg").classList];if(t||a.classList.remove(globalCustomNav.cfg.glbl.trayActiveClass),a.querySelector("svg").remove(),1==/^icon-[a-z]/.test(e.icon_svg)){let o=`<div id="${(t?"rspv-":"")+`${e.slug}-svg`}" role="presentation">`;o+=`<i class="icon-line ${e.icon_svg}${t?" gcn_inst_rspv_icon":""} gcn_inst_menu_icon"></i></div>`,s.insertAdjacentHTML("afterbegin",o)}else/^https/.test(e.icon_svg)?fetch(e.icon_svg,{mode:"cors",method:"GET",headers:{"Access-Control-Request-Method":"GET",Accept:"text/plain","Content-Type":"text/plain"}}).then((e=>e.text())).then((o=>{s.insertAdjacentHTML("afterbegin",o),a.querySelector("svg").setAttribute("id",(t?"rspv-":"")+`${e.slug}-svg`),a.querySelector("svg").classList.add(...c)})).catch(console.error.bind(console)):/^<svg/.test(e.icon_svg)&&(s.insertAdjacentHTML("afterbegin",e.icon_svg),a.querySelector("svg").setAttribute("id",(t?"rspv-":"")+`${e.slug}-svg`),a.querySelector("svg").classList.add(...c));e.icon=a},append_item:(e,t=!0)=>{const o=t?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector,r=document.querySelector(`${o} li:last-child`);if("undefined"!==e.position&&"number"==typeof e.position){const o=(1==t?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector)+` > li:nth-of-type(${e.position})`;document.querySelector(o).after(e.icon)}else"undefined"!==e.position&&"after"==e.position?r.after(e.icon):r.before(e.icon);const a=new RegExp(`^${e.href}`);!t&&a.test(window.location.pathname)&&(globalCustomNav.cfg.context_item=e.slug)}};

  // example options setup for items
  // customize what you need, remove what you don't
  // configure custom nav items
  const globalCustomNav_items = [{
      title: 'Instructure Icon',
      icon_svg: 'icon-pin',
      href: 'https://instructure.design/#icons-font', // find instructure icons here
      target: '_blank',
      position: 1, // can be one of : integer (position after first), 'after' (help or last), 'before' (help or last)
    },
    {
      title: 'Hosted Icon',
      // example only, host your own, or use icon class
      icon_svg: 'https://raw.githubusercontent.com/instructure/instructure-ui/master/packages/ui-icons/svg/Line/pin.svg',
      href: 'https://community.canvaslms.com/',
      target: '_blank',
      //position: 'before' // default
    },
    {
      title: 'Inline Icon',
      // example, instructure-ui pin.svg from above
      icon_svg: `<svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M1643.272 835.697c-22.024 22.023-57.826 22.023-79.85 0l-20.442-20.442c-.226-.226-.226-.452-.452-.678-.226-.113-.452-.113-.565-.339L1072.806 345.08c-.226-.225-.34-.564-.565-.79-.226-.226-.565-.339-.79-.452l-20.33-20.33c-22.024-22.023-22.024-57.938 0-79.962l83.915-83.802 592.15 592.038-83.914 83.915zm-506.768 305.167c-7.34-8.584-13.44-18.07-21.571-26.09L771.93 771.773c-8.018-8.132-17.506-13.892-26.09-21.12l286.42-286.419 390.437 390.438-286.193 286.193zm-101.42 453.007l-16.49 16.49-742.362-742.25 16.489-16.49c106.73-106.842 292.743-106.842 399.36 0l343.002 343.003c53.309 53.308 82.673 124.235 82.673 199.567 0 75.445-29.364 146.372-82.673 199.68zM1135.035.045L971.272 163.697c-59.295 59.294-62.344 150.776-15.022 216.847L658.876 677.918c-4.066 3.953-6.437 8.81-9.035 13.553-144.565-60.085-322.899-33.656-436.97 80.301l-96.338 96.34 411.106 411.105-511.06 511.059c-22.136 22.023-22.136 57.826 0 79.85 10.956 11.067 25.413 16.602 39.869 16.602s28.913-5.535 39.981-16.603l511.059-511.059 411.106 410.993 96.339-96.339c74.654-74.54 115.764-173.816 115.764-279.529 0-55.115-11.745-108.31-33.091-157.327 2.597-1.92 5.647-3.05 8.018-5.421l300.763-300.763c29.365 20.895 62.456 34.448 96.903 34.448 43.37 0 86.852-16.603 119.83-49.582l163.766-163.764L1135.036.045z" stroke="none" stroke-width="1" fill-rule="evenodd"/></svg>`,
      href: 'https://community.canvaslms.com/',
      target: '',
      position: 'after'
    },
    {
      title: 'Icon with Role Requirements - Faculty',
      // example icon with role requirement
      icon_svg: 'icon-educators',
      href: 'https://community.canvaslms.com/t5/Canvas-Instructor/ct-p/canvas_instructor',
      target: '_blank',
      position: 'after',
      roles: function () {
        var account_role = ['AccountAdmin', 'Staff Admin', 'Support Admin'].some(a => ENV.current_user_types.includes(a));
        var enrollment_type = ['teacher', 'admin', 'root_admin', 'consortium_admin'].some(a => ENV.current_user_roles.includes(a));
        return account_role || enrollment_type;
      }
    },
    {
      title: 'Icon with Role Requirements - Student',
      // example icon with role requirement
      icon_svg: 'icon-group',
      href: 'https://community.canvaslms.com/t5/Canvas-Student/ct-p/canvas_student',
      target: '_blank',
      position: 'after',
      roles: function () {
        return !['teacher', 'admin', 'root_admin', 'consortium_admin'].some(a => ENV.current_user_roles.includes(a));
      }
    }
  ];
  // load custom nav options
  globalCustomNav.load(globalCustomNav_items);

})();