/**
// @name        CanvasLMS - Global Custom Navigation
// @namespace   https://github.com/robert-carroll/canvaslms-global-custom-navigation
// @description items only, context capable
//
**/

// handle css in this js file, or you can remove it if...
// you include the contents of /css/global-custom-nav-items.css in your Canvas Themes css file
!function(){if(0==document.querySelectorAll('[data-global-custom-nav-css="set"]').length){let e={"i.gcn_inst_menu_icon:before":"font-size: 1.625rem;","i.gcn_inst_rspv_icon":"color: var(--ic-brand-primary);"};if(void 0!==e&&Object.keys(e).length>0){let t=document.createElement("style");t.setAttribute("data-global-custom-nav-css","set"),document.head.appendChild(t);let n=t.sheet;Object.keys(e).forEach((function(t){n.insertRule(`${t} { ${e[t]} }`,n.cssRules.length)}))}}}();

(function () {
  'use strict';

  // minified line for global custom nav [items only, context capable]
  const globalCustomNav={cfg:{context_item:"",glbl:{nav_selector:"#menu",tray_portal:"#nav-tray-portal",tray_container:"navigation-tray-container",space:"tray-with-space-for-global-nav",menuItemClass:"ic-app-header__menu-list-item",trayActiveClass:"ic-app-header__menu-list-item--active"},rspv:{tray_portal:`span[dir="${document.querySelector("html").getAttribute("dir")??"ltr"}"] div[role="dialog"] ul`,tray_container:'div[class$="-tray__content"]'},targets:["_self","_blank","_parent","_top"]},load:t=>{if(document.querySelector(globalCustomNav.cfg.glbl.nav_selector)||document.querySelector(globalCustomNav.cfg.rspv.tray_portal)){if("undefined"!==document.querySelector(globalCustomNav.cfg.glbl.nav_selector)){globalCustomNav.dir=document.querySelector("html").getAttribute("dir")??"ltr",globalCustomNav.nav_items=Array.isArray(t.nav_items)?t.nav_items:t;var e=document.querySelector(`${globalCustomNav.cfg.glbl.nav_selector} li.${globalCustomNav.cfg.glbl.trayActiveClass} a`);e&&(globalCustomNav.cfg.context_item=e.id||e.closest("li").id),globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!1)}globalCustomNav.watch_glbl_tray(),globalCustomNav.watch_burger_tray()}},watch_burger_tray:(t,e)=>{const l=document.querySelector(globalCustomNav.cfg.rspv.tray_portal),o=document.querySelector("div.rspv-global-custom-nav");if(l)null==l||null==document.querySelector(".mobile-header-hamburger").offsetParent||o||(e.disconnect(),globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!0),document.querySelector(globalCustomNav.cfg.rspv.tray_container).classList.add("rspv-global-custom-nav"),globalCustomNav.exit_burger_tray());else if(void 0===e){new MutationObserver(globalCustomNav.watch_burger_tray).observe(document.body,{childList:!0,subtree:!0})}},exit_burger_tray:(t,e)=>{const l=document.querySelector(globalCustomNav.cfg.rspv.tray_portal);if(l){if(void 0===e){new MutationObserver(globalCustomNav.exit_burger_tray).observe(document.body,{childList:!0,subtree:!0})}}else l||(e.disconnect(),globalCustomNav.watch_burger_tray())},watch_glbl_tray:(t,e)=>{const l=document.querySelector(globalCustomNav.cfg.glbl.tray_portal);if(!l){if(void 0===e){new MutationObserver(globalCustomNav.watch_glbl_tray).observe(document.body,{childList:!0})}return}void 0!==e&&e.disconnect(),globalCustomNav.glbl_ensure_active_class(globalCustomNav.cfg.context_item);new MutationObserver(globalCustomNav.exit_glbl_tray).observe(l,{childList:!0,subtree:!0})},exit_glbl_tray:(t,e)=>{const l=document.querySelector(`${globalCustomNav.cfg.glbl.tray_portal} div.${globalCustomNav.cfg.glbl.tray_container}`);if(l){let t=[...l.classList].filter((t=>t.endsWith("-tray")))[0].replace("-tray","");if(globalCustomNav.glbl_ensure_active_class(`global_nav_${t}_link`),void 0===e){new MutationObserver(globalCustomNav.exit_glbl_tray).observe(document.body,{childList:!0})}}else l||(e.disconnect(),globalCustomNav.watch_glbl_tray())},glbl_ensure_active_class:t=>{t&&(Array.from(document.querySelectorAll(`${globalCustomNav.cfg.glbl.nav_selector} .${globalCustomNav.cfg.glbl.trayActiveClass}`)).forEach((t=>{t.classList.toggle(globalCustomNav.cfg.glbl.trayActiveClass)})),document.getElementById(t).closest("li").classList.add(globalCustomNav.cfg.glbl.trayActiveClass))},prepare_nav_items:(t,e=!0)=>{t.forEach((t=>{(void 0===t.roles||t.roles())&&(globalCustomNav.create_nav_icon(t,e),globalCustomNav.append_item(t,e),t.tray&&globalCustomNav.tray(t,e))}))},create_nav_icon:(t,e=!0)=>{t.tidle=t.title.replace(/[\W_]+/g,"")||Math.random().toString(18).slice(2),t.slug=`global_nav_${t.tidle}_link`;const l=1==ENV.K5_USER&&1==e?"Home":"Dashboard",o=e?`${globalCustomNav.cfg.rspv.tray_portal} svg[name="Icon${l}"]`:`#global_nav_${l.toLowerCase()}_link`,a=document.querySelector(o).closest("li").cloneNode(!0);a.setAttribute("id",(e?"rspv-":"")+`${t.slug}-item`),a.querySelector("svg").parentElement.classList.add((e?"rspv-":"")+`svg-${t.tidle}-holder`);const r=(e?"rspv-":"")+t.slug;a.querySelector("a").setAttribute("id",r),a.querySelector("a").href=t.href,void 0!==t.target&&globalCustomNav.cfg.targets.includes(t.target)&&a.querySelector("a").setAttribute("target",t.target),(a.querySelector(".menu-item__text")||a.querySelector('span[letter-spacing="normal"]')).textContent=t.title;const s=a.querySelector((e?".rspv-svg":".svg")+`-${t.tidle}-holder`);a.querySelector("svg").classList.remove("ic-icon-svg--dashboard","svg-icon-home");let c=[...a.querySelector("svg").classList];if(e||a.classList.remove(globalCustomNav.cfg.glbl.trayActiveClass),a.querySelector("svg").remove(),1==/^icon-[a-z]/.test(t.icon_svg)){let l=`<div id="${(e?"rspv-":"")+`${t.slug}-svg`}" role="presentation">`;l+=`<i class="icon-line ${t.icon_svg}${e?" gcn_inst_rspv_icon":""} gcn_inst_menu_icon"></i></div>`,s.insertAdjacentHTML("afterbegin",l)}else/^https/.test(t.icon_svg)?fetch(t.icon_svg,{mode:"cors",method:"GET",headers:{"Access-Control-Request-Method":"GET",Accept:"text/plain","Content-Type":"text/plain"}}).then((t=>t.text())).then((l=>{s.insertAdjacentHTML("afterbegin",l),a.querySelector("svg").setAttribute("id",(e?"rspv-":"")+`${t.slug}-svg`),a.querySelector("svg").classList.add(...c)})).catch(console.error.bind(console)):/^<svg/.test(t.icon_svg)&&(s.insertAdjacentHTML("afterbegin",t.icon_svg),a.querySelector("svg").setAttribute("id",(e?"rspv-":"")+`${t.slug}-svg`),a.querySelector("svg").classList.add(...c));t.icon=a},append_item:(t,e=!0)=>{const l=e?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector,o=document.querySelector(`${l} li:last-child`);if("undefined"!==t.position&&"number"==typeof t.position){const l=(1==e?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector)+` > li:nth-of-type(${t.position})`;document.querySelector(l).after(t.icon)}else"undefined"!==t.position&&"after"==t.position?o.after(t.icon):o.before(t.icon);const a=new RegExp(`^${t.href}`);!e&&a.test(window.location.pathname)&&(globalCustomNav.cfg.context_item=t.slug,globalCustomNav.glbl_ensure_active_class(globalCustomNav.cfg.context_item))}};
  
  // example options setup for items
  // customize what you need, remove what you don't
  // configure custom nav items
  const globalCustomNav_items = [{
      title: 'Instructure Icon',
      icon_svg: 'icon-pin',
      href: 'https://instructure.design/#icons-font',
      target: '_blank',
      position: 1, // can be one of : integer (position after first), 'after' (help or last), 'before' (help or last)
    },
    {
      title: 'Custom Context',
      // custom context handles active class in global nav
      icon_svg: 'icon-expand-start',
      href: '/courses/101',
      target: '_top',
      roles: function () {
        return ['user'].some(a => ENV.current_user_roles.includes(a));
      }
    },
    {
      title: 'Custom Account Context',
      // custom context handles active class in global nav
      icon_svg: 'icon-ruler',
      href: '/accounts/self',
      target: '_self',
      roles: function () {
        return ['admin'].some(a => ENV.current_user_roles.includes(a));
      }
    }
  ];

  // load custom nav options
  globalCustomNav.load(globalCustomNav_items);

})();